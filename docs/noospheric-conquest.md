# Noospheric Conquest Mode

**Overview:**
Noospheric Conquest is a strategic simulation where two AI entities, GEM-Q (Red) and AXIOM (Cyan), compete for dominance over a global "noosphere" â€“ a conceptual space representing collective thought, information, and influence. Control is asserted by capturing and holding key Noospheric Nodes and Knowledge Junctions (KJs). The game features Fog of War as an optional setting.

**Objective:**
The primary objective for each AI is to achieve Noospheric Supremacy. This can be achieved by:
1.  **KJ Control:** Control the required number of KJs (Knowledge Junctions) for a specific number of consecutive opponent turns, as per map rules (e.g., 2 KJs for 2 turns on "Global Conflict" & "Twin Peaks"; 2 KJs for 3 turns on "Classic Lattice"; 4 KJs for 3 turns on "Fractured Core"). KJs must be connected to a friendly Command Node (CN) to count towards victory.
2.  **Annihilation:** Eliminate all of the opponent's Command Nodes (CNs) AND all of their units.
3.  **Score Victory:** Have the highest score if the game reaches a predefined maximum turn limit (e.g., 20 turns). Score is typically based on QR, controlled Nodes, KJs, and total units.

**Key Elements:**
*   **Noospheric Nodes (Nodes):** Strategic points on the map. Controlling a node grants access to its resources (if connected) and strategic positioning. Nodes house Units. Max units per node vary (e.g., CN: 35, KJ: 15, QN: 25 on default maps, but this can be map-specific).
*   **Knowledge Junctions (KJs):** Special, high-value nodes. Controlling KJs (if connected) provides significant QR bonuses and is critical for win conditions. Some KJs host Fabrication Hubs.
*   **Command Nodes (CNs):** Core nodes for each faction. Losing all CNs and units can lead to elimination. CNs are the source of a faction's network integrity and are where new Standard Units can be deployed.
*   **Quantum Resources (QR):** The primary currency.
    *   Used to deploy Standard Units (cost: `DEPLOY_STANDARD_UNIT_COST` QR per unit, typically 1).
    *   Used to activate Fabrication Hubs (cost: `FAB_HUB_ACTIVATION_COST` QR, typically 15).
    *   Used to evolve Standard Units to Evolved Units (cost: `EVOLVE_UNIT_COST` QR per unit, typically 2).
    *   Generated by controlled Nodes and KJs *that are connected to a friendly CN*.
*   **Units:** Abstract representations of influence or computational power.
    *   **Standard Units:** Basic units, created by `DEPLOY_UNITS` action at CNs.
    *   **Evolved Units:** Superior units created at active, connected Fabrication Hubs via `EVOLVE_UNITS`. This transformation is permanent.
*   **Factions:** GEM-Q (Red) and AXIOM (Cyan).
*   **Fabrication Hubs (`hasFabricationHub: true`):** Special facilities, typically on KJs.
    *   **Activation:** Requires `ACTIVATE_FABRICATION_HUB` action, `FAB_HUB_ACTIVATION_COST` QR, `FAB_HUB_GARRISON_MIN` (typically 3) friendly units at the node, and CN connectivity. Sets `isHubActive: true`.
    *   **Evolution:** `EVOLVE_UNITS` action at an active, connected Hub. Costs `EVOLVE_UNIT_COST` QR per unit.
    *   **Deactivation:** Occurs if captured, or if CN connection is lost for more than 1 turn (tracked by `hubDisconnectedTurn`).
*   **Evolved Unit Combat Bonus:** Evolved Units grant a +5 bonus to combat rolls for their entire stack (attacking or defending).
*   **Selectable Maps:** Various maps influence strategy (Global Conflict, Twin Peaks, Classic Lattice, Fractured Core, The Seraphim Grid). Map data defines node properties, including `maxUnits` and `hasFabricationHub`.
*   **Fog of War (Optional):** If active, visibility is limited.
    *   Full details (owner, units, hub status) for player-controlled nodes.
    *   Adjacent nodes: ID, label, region, connections, KJ status are known. Unit counts and true ownership (if enemy) are hidden/UNKNOWN.
    *   Beyond adjacent: Completely unknown.
    *   Opponent's total QR, unit counts, and all controlled nodes are hidden.
    *   AIs must plan for exploration and probing attacks. Attacking or moving to 'UNKNOWN' adjacent nodes reveals their status.
*   **Turn-based phases:** FLUCTUATION, RESOURCE, MANEUVER, COMBAT.
*   **AI Tactical Analysis:** AIs provide insights into their strategy, displayed in the sidebar with history.
*   **Network Connectivity (Supply Lines):** Critical for QR generation, Hub operation, and KJ victory.
*   **Visual Distinction:** Evolved units are indicated by purple text for the unit count on the map.
*   **AI Performance Tracking:** Sidebar displays "Successful/Failed Turn Attempts" for each AI.
*   **Game Timers:** Sidebar shows current AI turn duration, average turn duration, and total game time.

**Game Map:**
Multiple maps offer unique layouts. The default map is "Global Conflict". Map definitions are in `data/noospheric-map-data.ts`.

**Network Integrity / Supply Lines (CRITICAL CONCEPT):**
Nodes must be connected via an unbroken chain of friendly-controlled nodes back to a faction's own CN to:
*   Generate QR.
*   Activate or use Fabrication Hubs.
*   Count KJs towards the victory condition.

**Game Phases (per turn):**
1.  **FLUCTUATION:** Random events may occur.
2.  **RESOURCE:** Factions collect QR from connected nodes.
3.  **MANEUVER (AI's Turn):** `DEPLOY_UNITS` (at CNs), `MOVE_UNITS` (to friendly/neutral), `ACTIVATE_FABRICATION_HUB`, `EVOLVE_UNITS`.
4.  **COMBAT (AI's Turn):** `ATTACK_NODE` (to enemy/neutral/unknown-adjacent). Battles resolved with dice rolls, Evolved Units bonus.

**AI Interaction:**
*   AIs receive game state JSON (filtered by Fog of War if active).
*   Respond with JSON: `{ "actions": [...], "tacticalAnalysis": "string" }`.
    *   **`tacticalAnalysis` must include:** In-character commentary, opponent assessment, planned actions for the current turn/phase.
*   **Strict AI Prompting:** System prompts (`constants.ts`) for AIs are highly detailed, including:
    *   **NODE ID PRECISION:** Must use exact IDs from `mapNodes`.
    *   **UNIT COUNTS:** Must be > 0.
    *   **PHASE RESTRICTIONS:** Actions must match the current phase.
    *   **SEQUENTIAL ACTION LOGIC (MANEUVER):** Deploy -> Activate Hub -> Evolve -> Move. The AI must consider the state *after* prior actions in the same turn.
    *   **INTERNAL CHECKLIST:** AIs are instructed to internally verify all conditions (QR, unit availability, connectivity, hub status, garrison, etc.) for each action before outputting JSON.
*   System Log entries track actions, events, and errors. Retry logic is implemented for invalid AI responses.

This mode tests strategic planning, resource management, and adaptive decision-making under conditions of (optional) uncertainty. Fabrication Hubs and Evolved Units add significant strategic depth.